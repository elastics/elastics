<!DOCTYPE html>
<html>
  <head>
    <link href='/elastics/assets/global-74df1a51e3d7075c146b619ddfd07904.css' rel='stylesheet' type='text/css' />
<script src='/elastics/assets/global-aacc71e3a462796a62993fb5a8b696a3.js' type='text/javascript'></script>
<title>Elastics - elastics-client - Tags</title>
    <meta charset="UTF-8" />
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-42574355-3', 'elasticston
      .github.io');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div id="page-nav" class="nocontent">
      <ul id="nav-menu" class="menu_h_list"><li><a href="#" class="isLabel">elastics</a><ul><li><a href="/elastics/doc/1-elastics/1-Overview.html">Elastics Overview</a></li><li><a href="/elastics/doc/1-elastics/2-Usage-Overview.html">Usage Overview</a></li><li><a href="/elastics/doc/1-elastics/3-Configuration.html">Configuration</a></li><li><a href="/elastics/doc/1-elastics/4-Rake-Tasks.html">Rake Tasks</a></li></ul></li><li><a href="#" class="isLabel">elastics-client</a><ul><li><a href="/elastics/doc/2-elastics-client/1-Overview.html">Overview</a></li><li><a href="/elastics/doc/2-elastics-client/2-API-Methods.html">API Methods</a></li><li><a href="#" class="isLabel">Templating</a><div class="arrow right"></div><ul><li><a href="/elastics/doc/2-elastics-client/3-Templating/1-Templates.html">Templates</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/2-Sources.html">Template Sources</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/3-Tags.html">Tags</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/4-Variables.html">Variables</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/5-Interpolation.html">Interpolation</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/6-Partials.html">Partial Templates</a></li></ul></li><li><a href="/elastics/doc/2-elastics-client/4-Result-Extenders.html">Result Extenders</a></li><li><a href="/elastics/doc/2-elastics-client/5-Self-Documentation.html">Self Documentation</a></li><li><a href="/elastics/doc/2-elastics-client/6-Utility-Methods.html">Utility Methods</a></li></ul></li><li><a href="#" class="isLabel">elastics-scopes</a><ul><li><a href="/elastics/doc/3-elastics-scopes/1-Overview.html">Overview</a></li><li><a href="/elastics/doc/3-elastics-scopes/2-Scopes.html">Scopes</a></li></ul></li><li><a href="#" class="isLabel">elastics-models</a><ul><li><a href="/elastics/doc/4-elastics-models/1-Overview.html">Overview</a></li><li><a href="/elastics/doc/4-elastics-models/2-ActiveRecord-And-Mongoid-Integration.html">ActiveRecord And Mongoid Integration</a></li><li><a href="/elastics/doc/4-elastics-models/3-ActiveModel-Integration.html">ActiveModel Integration</a></li><li><a href="#" class="isLabel">Modules</a><div class="arrow right"></div><ul><li><a href="/elastics/doc/4-elastics-models/4-Modules/1-Elastics::ModelSyncer.html">Elastics::ModelSyncer</a></li><li><a href="/elastics/doc/4-elastics-models/4-Modules/2-Elastics::ModelIndexer.html">Elastics::ModelIndexer</a></li><li><a href="/elastics/doc/4-elastics-models/4-Modules/3-Elastics::ActiveModel.html">Elastics::ActiveModel</a></li></ul></li><li><a href="/elastics/doc/4-elastics-models/5-Result-Extenders.html">Result Extenders</a></li></ul></li><li><a href="#" class="isLabel">elastics-rails</a><ul><li><a href="/elastics/doc/5-elastics-rails/1-Overview.html">Overview</a></li><li><a href="/elastics/doc/5-elastics-rails/2-Result-Extenders.html">Result Extenders</a></li></ul></li><li><a href="#" class="isLabel">elastics-admin</a><ul><li><a href="/elastics/doc/6-elastics-admin/1-Binary.html">Binary</a></li><li><a href="/elastics/doc/6-elastics-admin/2-Live-Reindex.html">Live Reindex</a></li></ul></li><li><a href="#" class="isLabel">tutorials</a><ul><li><a href="/elastics/doc/7-tutorials/1-Elastics-vs-Tire.html">Why you should use Elastics rather than Tire</a></li><li><a href="/elastics/doc/7-tutorials/2-Migrate-from-0.x.html">How to migrate from Flex 0.x</a></li><li><a href="/elastics/doc/7-tutorials/3-Index-and-Search-your-Models.html">Index and Search your Models</a></li><li><a href="/elastics/doc/7-tutorials/4-Index-and-Search-External-Data.html">Index and Search External Data</a></li></ul></li></ul>
      <div id="google-search">
        <script type="text/javascript">
          (function() {
            var cx = '001168365143071728136:w4opkcwdl3y';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
        </script>
        <gcse:search>&nbsp;</gcse:search>
      </div>
    </div>
    <div id="page-toc">
      <div id="logo">
        <img src="/elastics/images/elastics-logo-200.png" />
      </div>
    </div>
    <div id="content">
      <a id="badge" href="https://badge.fury.io/rb/elastics-client"><img src="https://badge.fury.io/rb/elastics-client.png" /></a>
      <div class="breadcrumb nocontent">
        <span><a href="/elastics/doc">Elastics</a></span> &gt; <span><a href="/elastics/doc/2-elastics-client">elastics-client</a></span> &gt; <span><a href="/elastics/doc/2-elastics-client/3-Templating">Templating</a></span> &gt; <span>Tags</span>
      </div>
      <h1 id="tags">Tags</h1>

<p>Templates are actually a very clean way to define a query method, but a template without tags generates a completely static method. For example the following template will always request the same query:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">my_request</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">query</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">term</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">25</span></code></pre></div>

<p>That may make sense in some context, but typically we would like to use the same template with a different <code>user_id</code> for example. So letâ€™s replace the parts that we want to be dynamic with a simple named tags:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">my_request</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">query</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">term</span><span class="p-Indicator">:</span>
     <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;&lt;user_id&gt;&gt;</span></code></pre></div>

<p>Now we can interpolate the <code>user_id</code> tag by just passing its value as a variable, matching tag names with variable keys.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">results1</span> <span class="o">=</span> <span class="no">MyClass</span><span class="o">.</span><span class="n">my_request</span> <span class="ss">:user_id</span> <span class="o">=&gt;</span> <span class="mi">25</span>
<span class="n">results2</span> <span class="o">=</span> <span class="no">MyClass</span><span class="o">.</span><span class="n">my_request</span> <span class="ss">:user_id</span> <span class="o">=&gt;</span> <span class="mi">49</span></code></pre></div>

<h2 id="tags-syntax">Tags Syntax</h2>

<p>Tags are used as placeholder for the real values that will be interpolated into the structure just before executing the http request. The syntax follows a few very simple rules:</p>

<ul>
  <li>their name must be suitable to be ruby method names</li>
  <li>they must not be one of the reserved variable names (see <a href="/elastics/doc/2-elastics-client/3-Templating/4-Variables.html#special_variables">Special Variables</a>)</li>
  <li>you can use or omit spaces around names</li>
  <li>they may contextually define a default (similar to the arguments of a ruby method)</li>
</ul>

<p>Here are a few examples of tags:</p>

<pre><code>&lt;&lt;a_tag&gt;&gt;
&lt;&lt; another_tag &gt;&gt;
&lt;&lt;a_tag_with_default= the default &gt;&gt;
&lt;&lt; an_optional_tag= ~ &gt;&gt;
&lt;&lt; _a_partial_template &gt;&gt;
"&lt;&lt;a_quote_wrapped_tag= {query: '*'} &gt;&gt;" # (the wrapping quotes avoid a YAML parsing error due to the ':')
&lt;&lt; a_nested.tag.1 &gt;&gt; # (will be interpolated with :a_nested[:tag][1] variable value)
</code></pre>

<p>You are not limited to use tag as value placeholder: you can use them anywhere in the yaml, also as key placeholder or partial keys or values if it makes sense to you:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">most_counted</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sort</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">&lt;&lt;counter&gt;&gt;_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">desc</span></code></pre></div>

<p>Just remember that they will be substituted by the values that a variable key of the same name will contain, so for example using the above template:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">blog_sorted</span> <span class="o">=</span> <span class="no">MyClass</span><span class="o">.</span><span class="n">most_counted</span> <span class="ss">:counter</span> <span class="o">=&gt;</span> <span class="s1">&#39;blog&#39;</span>
<span class="n">post_sorted</span> <span class="o">=</span> <span class="no">MyClass</span><span class="o">.</span><span class="n">most_counted</span> <span class="ss">:counter</span> <span class="o">=&gt;</span> <span class="s1">&#39;post&#39;</span></code></pre></div>

<p>will respectively generate <code>{"sort":{"blog_count":"desc"}}</code> <code>{"sort":{"post_count":"desc"}}</code> data queries.</p>

<p>(see <a href="/elastics/doc/2-elastics-client/3-Templating/5-Interpolation.html">Interpolation</a>)</p>

<h2 id="tag-defaults">Tag defaults</h2>

<p>Tags interpolation is very easy and straightforward, but tags can do more for you. For example, letâ€™s say we want to use a default <code>user_id</code> when we donâ€™t have any specific one. So letâ€™s add a default:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">my_request</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">query</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">term</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;&lt;user_id= 10 &gt;&gt;</span></code></pre></div>

<p>With this template/method if we donâ€™t pass any <code>:user_id</code> variable, the default value will be used. So we can use the query method like:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">results1 = MyClass.my_request</span> <span class="c1"># will use :user_id =&gt; 10</span>
<span class="l-Scalar-Plain">results2 = MyClass.my_request :user_id =&gt; 45</span></code></pre></div>

<p>Tags defaults work very similarly to the argument defaults of ruby methods. Notice however that the default string (from the <code>=</code> to the closing <code>&gt;&gt;</code>) is evaluated as a <code>YAML</code> string as well, so you may need to wrap the tag in quotes if you want to pass valid <code>YAML</code> as a default. Besides, if you want to define a <code>nil</code> value as a default, you should use the <code>~</code> character (that <code>YAML</code> explicitly evaluates to nil). Besides, <code>nil</code> as a default will also make the tag optional.</p>

<p>(see <a href="/elastics/doc/2-elastics-client/3-Templating/4-Variables.html">Variables</a>)</p>

<br />
      <div class="breadcrumb nocontent">
        <span><a href="/elastics/doc">Elastics</a></span> &gt; <span><a href="/elastics/doc/2-elastics-client">elastics-client</a></span> &gt; <span><a href="/elastics/doc/2-elastics-client/3-Templating">Templating</a></span> &gt; <span>Tags</span>
      </div>
    </div>
    <div id="footer" class="nocontent">
      Copyright &copy; 2012-2013 by <a href="mailto://dd.nexus@gmail.com">Domizio Demichelis</a> &mdash; Sponsored by <a href="http://www.escalatemedia.com">Escalate Media</a> and <a href="http://www.barquin.com">Barquin International</a>
    </div>
  </body>
</html>