<!DOCTYPE html>
<html>
  <head>
    <link href='/elastics/assets/global-74df1a51e3d7075c146b619ddfd07904.css' rel='stylesheet' type='text/css' />
<script src='/elastics/assets/global-aacc71e3a462796a62993fb5a8b696a3.js' type='text/javascript'></script>
<title>Elastics - elastics-rails - Overview</title>
    <meta charset="UTF-8" />
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-42574355-3', 'elasticston
      .github.io');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div id="page-nav" class="nocontent">
      <ul id="nav-menu" class="menu_h_list"><li><a href="#" class="isLabel">elastics</a><ul><li><a href="/elastics/doc/1-elastics/1-Overview.html">Elastics Overview</a></li><li><a href="/elastics/doc/1-elastics/2-Usage-Overview.html">Usage Overview</a></li><li><a href="/elastics/doc/1-elastics/3-Configuration.html">Configuration</a></li><li><a href="/elastics/doc/1-elastics/4-Rake-Tasks.html">Rake Tasks</a></li></ul></li><li><a href="#" class="isLabel">elastics-client</a><ul><li><a href="/elastics/doc/2-elastics-client/1-Overview.html">Overview</a></li><li><a href="/elastics/doc/2-elastics-client/2-API-Methods.html">API Methods</a></li><li><a href="#" class="isLabel">Templating</a><div class="arrow right"></div><ul><li><a href="/elastics/doc/2-elastics-client/3-Templating/1-Templates.html">Templates</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/2-Sources.html">Template Sources</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/3-Tags.html">Tags</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/4-Variables.html">Variables</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/5-Interpolation.html">Interpolation</a></li><li><a href="/elastics/doc/2-elastics-client/3-Templating/6-Partials.html">Partial Templates</a></li></ul></li><li><a href="/elastics/doc/2-elastics-client/4-Result-Extenders.html">Result Extenders</a></li><li><a href="/elastics/doc/2-elastics-client/5-Self-Documentation.html">Self Documentation</a></li><li><a href="/elastics/doc/2-elastics-client/6-Utility-Methods.html">Utility Methods</a></li></ul></li><li><a href="#" class="isLabel">elastics-scopes</a><ul><li><a href="/elastics/doc/3-elastics-scopes/1-Overview.html">Overview</a></li><li><a href="/elastics/doc/3-elastics-scopes/2-Scopes.html">Scopes</a></li></ul></li><li><a href="#" class="isLabel">elastics-models</a><ul><li><a href="/elastics/doc/4-elastics-models/1-Overview.html">Overview</a></li><li><a href="/elastics/doc/4-elastics-models/2-ActiveRecord-And-Mongoid-Integration.html">ActiveRecord And Mongoid Integration</a></li><li><a href="/elastics/doc/4-elastics-models/3-ActiveModel-Integration.html">ActiveModel Integration</a></li><li><a href="#" class="isLabel">Modules</a><div class="arrow right"></div><ul><li><a href="/elastics/doc/4-elastics-models/4-Modules/1-Elastics::ModelSyncer.html">Elastics::ModelSyncer</a></li><li><a href="/elastics/doc/4-elastics-models/4-Modules/2-Elastics::ModelIndexer.html">Elastics::ModelIndexer</a></li><li><a href="/elastics/doc/4-elastics-models/4-Modules/3-Elastics::ActiveModel.html">Elastics::ActiveModel</a></li></ul></li><li><a href="/elastics/doc/4-elastics-models/5-Result-Extenders.html">Result Extenders</a></li></ul></li><li><a href="#" class="isLabel">elastics-rails</a><ul><li><a href="/elastics/doc/5-elastics-rails/1-Overview.html">Overview</a></li><li><a href="/elastics/doc/5-elastics-rails/2-Result-Extenders.html">Result Extenders</a></li></ul></li><li><a href="#" class="isLabel">elastics-admin</a><ul><li><a href="/elastics/doc/6-elastics-admin/1-Binary.html">Binary</a></li><li><a href="/elastics/doc/6-elastics-admin/2-Live-Reindex.html">Live Reindex</a></li></ul></li><li><a href="#" class="isLabel">tutorials</a><ul><li><a href="/elastics/doc/7-tutorials/1-Elastics-vs-Tire.html">Why you should use Elastics rather than Tire</a></li><li><a href="/elastics/doc/7-tutorials/2-Migrate-from-0.x.html">How to migrate from Flex 0.x</a></li><li><a href="/elastics/doc/7-tutorials/3-Index-and-Search-your-Models.html">Index and Search your Models</a></li><li><a href="/elastics/doc/7-tutorials/4-Index-and-Search-External-Data.html">Index and Search External Data</a></li></ul></li></ul>
      <div id="google-search">
        <script type="text/javascript">
          (function() {
            var cx = '001168365143071728136:w4opkcwdl3y';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
        </script>
        <gcse:search>&nbsp;</gcse:search>
      </div>
    </div>
    <div id="page-toc">
      <div id="logo">
        <img src="/elastics/images/elastics-logo-200.png" />
      </div>
    </div>
    <div id="content">
      <a id="badge" href="https://badge.fury.io/rb/elastics-rails"><img src="https://badge.fury.io/rb/elastics-rails.png" /></a>
      <div class="breadcrumb nocontent">
        <span><a href="/elastics/doc">Elastics</a></span> &gt; <span><a href="/elastics/doc/5-elastics-rails">elastics-rails</a></span> &gt; <span>Overview</span>
      </div>
      <h1 id="elastics-rails---overview">elastics-rails - Overview</h1>

<p>The <code>elastics-rails</code> gem provides the engine and generators to integrate the elastics gems with <code>Rails</code>. It also loads the <code>elastics-client</code>, <code>elastics-scopes</code> and <code>elastics-models</code> gems, so you donâ€™t have to explicitly include them in the Gemfile, unless you need to force some special version or commit. On the other hand you may want to add the <code>elastics-admin</code> gem which is optional.</p>

<h2 id="setup">Setup</h2>

<h3 id="customize-the-gemfile">1. Customize the <code>Gemfile</code></h3>

<p>Add the following to your Gemfile:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># use one of the following</span>
<span class="c1"># libcurl C based http client - faster</span>
<span class="n">gem</span> <span class="s1">&#39;patron&#39;</span>
<span class="c1"># pure ruby http client - more compatible</span>
<span class="c1"># gem &#39;rest-client&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;elastics-rails&#39;</span>
<span class="c1"># use elastics-admin if you need to dump/load/rename/live-reindex</span>
<span class="c1"># gem &#39;elastics-admin&#39;</span></code></pre></div>

<blockquote>
  <p><strong>Temporary Note</strong>: The <code>patron</code> gem currently available on rubygem (v0.4.18) is missing the support for sending data with delete queries. As the result it fails with the <code>delete_by_query</code> elasticsearch API, when the query is the request body and not the param. If you want full support until a new version will be pushed to rubygems, you should use <code>gem 'patron', :git =&gt; 'https://github.com/patron/patron.git'</code> or switch to the <code>rest-client</code> gem.</p>
</blockquote>

<h3 id="run-bundle-install">2. Run <code>bundle install</code></h3>

<h3 id="run-rails-generate-elasticssetup">3. Run <code>rails generate elastics:setup</code></h3>

<p>That will install the needed files with comments and stubs.</p>

<h2 id="work-flow">Work Flow</h2>

<h3 id="customize-your-models">1. Customize your models</h3>

<p>Add the <code>include Elastics::&lt;some_model_module&gt;</code> to the model that need it (see <a href="/elastics/doc/4-elastics-models">elastics-models</a>).</p>

<ul>
  <li>Each time you include a <code>Elastics::ModelIndexer</code> or <code>Elastics::ActiveModel</code> you should add its name to the <code>config/initializers/elastics.rb</code></li>
  <li>Each time you alter the way your models generate the source that will be indexed (for example by changing your <code>elastics_source</code> methods or adding/changing a <code>elastics.parent</code> relation in a model) you should reindex your DB(s) (see <a href="/elastics/doc/6-elastics-admin/2-Live-Reindex.html">Live Reindex</a>)</li>
</ul>

<h3 id="customize-the-configinitializerselasticsrb">2. Customize the <code>config/initializers/elastics.rb</code></h3>

<p>In this initializer you must add the <code>elastics_models</code> and/or <code>elastics_active_models</code> arrays. They are the names or the classes of the models that you customized with <code>include Elastics::ModelIndexer</code> or <code>include Elastics::ActiveModel</code>, and may want to customize other configuration variables. For example:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Elastics</span><span class="o">::</span><span class="no">Configuration</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">elastics_models</span> <span class="o">=</span> <span class="sx">%w[ Project ]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">elastics_active_models</span> <span class="o">=</span> <span class="sx">%w[ WebContent ]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">result_extenders</span> <span class="o">|=</span> <span class="o">[</span><span class="no">YourResultExtenderA</span><span class="p">,</span> <span class="no">YourResultExtenderB</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">deep_merge!</span> <span class="ss">:index</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
                               <span class="ss">:type</span>  <span class="o">=&gt;</span> <span class="s1">&#39;project&#39;</span>
<span class="k">end</span></code></pre></div>

<p>(see <a href="/elastics/doc/1-elastics/3-Configuration.html">Configuration</a>)</p>

<h3 id="customize-configelasticsyml">3. Customize <code>config/elastics.yml</code></h3>

<p>This is an optional yaml file used to add custom mapping to your index or indices. You donâ€™t need to use it unless you start to map your index/indices better. Elastics provides a quite detailed mapping by default, keeping into consideration all your indexed models and also parent/child relationships. Your file will be deep merged with the structure that Elastics will prepare on its own. You can inspect the mapping in the console with one of:</p>

<div class="highlight"><pre><code class="language-irb" data-lang="irb"><span class="gp">&gt;&gt; </span><span class="no">Elastics</span><span class="o">.</span><span class="n">get_mapping</span>
<span class="gp">&gt;&gt; </span><span class="no">Elastics</span><span class="o">.</span><span class="n">get_mapping</span> <span class="ss">:index</span> <span class="o">=&gt;</span> <span class="s1">&#39;the_index&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="kp">nil</span></code></pre></div>

<p>While at it you can get info about the method and the usage of <code>get_mapping</code> by doing as usual:</p>

<div class="highlight"><pre><code class="language-irb" data-lang="irb"><span class="gp">&gt;&gt; </span><span class="no">Elastics</span><span class="o">.</span><span class="n">doc</span> <span class="ss">:get_mapping</span></code></pre></div>

<p>(see <a href="/elastics/doc/2-elastics-client/5-Self-Documentation.html">Self Documentation</a>)</p>

<h3 id="run-rake-elasticsindexcreate-or-rake-elasticsimport">4. Run <code>rake elastics:index:create</code> or <code>rake elastics:import</code></h3>

<p>You sould use either <code>rake elastics:index:create</code> or <code>rake elastics:import</code> (if you already have data to index from your DB) in order to create a new index and its auto-generated mapping.</p>

<h3 id="customize-the-appelastics">5. Customize the <code>app/elastics/*</code></h3>

<p>Usually contains your search classes (those that include any of <code>Elastics::Templates</code>, <code>Elastics::ModelIndexer</code>, etc.) and your Tempates Sources (see <a href="/elastics/doc/2-elastics-client/3-Templating/2-Sources.html">Template Sources</a>). Average applications usually have just one class and one source template file but your mileage may vary. Here you can also add your Result Extenders modules (see <a href="/elastics/doc/2-elastics-client/4-Result-Extenders.html">Result Extenders</a>), so keeping all the Elastics related files together.</p>

<h2 id="rails-3-and-4">Rails 3 and 4</h2>

<p>Elastics comes with a Rails engine that integrates with your app very easily. The engine sets a few configuration defaults:</p>

<ul>
  <li><code>config.elastics.variables[:index]</code> to your applicationâ€™s underscored name, plus the current <code>Rails.env</code> (e.g. <code>'my_app_development'</code>)</li>
  <li><code>config.elastics.config_file</code> default path to <code>"#{Rails.root}/config/elastics.yml"</code></li>
  <li><code>config.elastics.elastics_dir</code> default path to <code>"#{Rails.root}/app/elastics"</code></li>
  <li><code>config.elastics.logger.level</code> to <code>Logger::DEBUG</code> in development mode (<code>Logger::WARN</code> otherwise)</li>
  <li><code>config.elastics.logger.log_to_rails_logger</code> to <code>true</code> for the Rails server and <code>false</code> for the Rails console</li>
  <li><code>config.elastics.logger.log_to_stderr</code> to <code>false</code> for the Rails server and <code>true</code> for the Rails console</li>
  <li><code>config.elastics.logger.debug_result</code> to <code>true</code> for the Rails server and <code>false</code> for the Rails console</li>
</ul>

<p>(see <a href="/elastics/doc/1-elastics/3-Configuration.html">Configuration</a>)</p>

<h2 id="per-environment-configuration">Per Environment Configuration</h2>

<p>You might want to have different configuration settings for different environments. You can do so by using the <code>config.elastics</code> object in the environment file, for example:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">.</span><span class="n">elastics</span><span class="o">.</span><span class="n">http_client</span>          <span class="o">=</span> <span class="no">Elastics</span><span class="o">::</span><span class="no">HttpClients</span><span class="o">::</span><span class="no">RestClient</span>
<span class="n">config</span><span class="o">.</span><span class="n">elastics</span><span class="o">.</span><span class="n">http_client</span><span class="o">.</span><span class="n">base_uri</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:9400&#39;</span></code></pre></div>

<h2 id="rails-2">Rails 2</h2>

<p>You can use Elastics with Rails 2 applications as well, just remember that you should require <code>elastics-rails</code> so it will set the <code>config_file</code> and <code>elastics_dir</code> paths for you (see <a href="/elastics/doc/1-elastics/3-Configuration.html">Configuration</a>), but remember that the default <code>config.elastics.variables[:index]</code> variable and the <code>config.elastics.app_id</code> for Rails 2 are not set so you better configure them, somewhere. Also remember that you should explicitly call <code>Elastics::Rails::Helper.after_initialize</code> to complete the rails integration. Except this little difference in the configuration, there is no other difference from Rails 3 and 4.</p>

<br />
      <div class="breadcrumb nocontent">
        <span><a href="/elastics/doc">Elastics</a></span> &gt; <span><a href="/elastics/doc/5-elastics-rails">elastics-rails</a></span> &gt; <span>Overview</span>
      </div>
    </div>
    <div id="footer" class="nocontent">
      Copyright &copy; 2012-2013 by <a href="mailto://dd.nexus@gmail.com">Domizio Demichelis</a> &mdash; Sponsored by <a href="http://www.escalatemedia.com">Escalate Media</a> and <a href="http://www.barquin.com">Barquin International</a>
    </div>
  </body>
</html>